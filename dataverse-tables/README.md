# Dataverse テーブル定義

## 概要
業務プロセスエディターで作成したプロセスをDataverseに保存するためのテーブル定義です。
シンプルな1テーブル構成で、Markdown形式でプロセス全体を保存します。

## テーブル構造

### Business Process (cr_businessprocess)
**用途**: 業務プロセスの全情報を格納

**主要フィールド**:
- `cr_name`: プロセス名（1行テキスト）
  - 例: "購買申請承認フロー"
  
- `cr_description`: プロセスの説明（複数行テキスト）
  - 例: "従業員の購買申請から承認、発注、納品、検収までの業務フローを定義します。"
  
- `cr_markdown`: 業務プロセス全体（複数行テキスト、Markdown形式）
  - スイムレーン、ノード、エッジ、関連システム、帳票などすべての情報を含む
  - マークダウン読込/出力機能でそのまま使用可能

**システムフィールド**:
- `createdon`: 作成日時
- `modifiedon`: 更新日時
- `createdby`: 作成者
- `modifiedby`: 更新者
- `statecode`: 状態（アクティブ/非アクティブ）
- `statuscode`: ステータス理由

## Markdownフィールドのサンプル

```markdown
# 購買申請承認フロー

## 概要
従業員の購買申請から承認、発注、納品、検収までの業務フローを定義します。

## 担当部門
- 経理部 - 申請者
- 経理部 - 上長
- 購買部門
- 経理部 - 承認者

## プロセス手順
1. [経理部 - 申請者] (開始) 購買申請開始
2. [経理部 - 申請者] (プロセス) 購買申請書作成
3. [経理部 - 上長] (判断) 金額確認: 10万円以上かどうかを判断
4. [経理部 - 上長] (プロセス) 一次承認: 10万円未満の場合
5. [経理部 - 承認者] (判断) 予算確認: 10万円以上の場合、予算内かどうか確認
6. [経理部 - 承認者] (プロセス) 最終承認
7. [経理部 - 申請者] (プロセス) 申請修正: 予算超過の場合
8. [購買部門] (プロセス) 発注処理
9. [購買部門] (プロセス) 納品確認
10. [経理部 - 申請者] (プロセス) 検収確認
11. [経理部 - 承認者] (プロセス) 支払処理
12. [経理部 - 申請者] (終了) 購買完了

## 関連システム
- 購買管理システム
- 予算管理システム
- 会計システム

## 帳票
- 購買申請書
- 承認記録
- 発注書
- 納品書
- 検収書
- 支払依頼書
```

## 使用方法

### 1. Dataverseテーブル作成
`BusinessProcess_table.csv`を参考に、Dataverse上でテーブルを作成します。

### 2. カスタムテーブルの名前付け規則
- テーブルの論理名: `cr_businessprocess`（Custom Record）
- フィールドの論理名にも `cr_` プレフィックスを使用

### 3. データの保存と読み込み
**保存時**:
1. プロセス名を`cr_name`に保存
2. プロセス説明を`cr_description`に保存
3. エディターから「MD出力」でMarkdownを生成
4. 生成されたMarkdownを`cr_markdown`に保存

**読み込み時**:
1. `cr_markdown`からMarkdownを取得
2. エディターの「MD読込」機能でMarkdownをインポート
3. 自動的にビジュアルフローチャートが生成される

## メリット

### シンプルな構造
- テーブル1つのみで管理が容易
- リレーションシップ不要
- データの移行・バックアップが簡単

### Markdown活用
- テキストエディタでも編集可能
- バージョン管理システム（Git等）との親和性が高い
- ドキュメントとしてそのまま共有可能
- エクスポート/インポートが容易

### 柔軟性
- プロセス構造の変更に強い
- 新しいノードタイプや情報の追加が容易
- 既存データへの影響が少ない

## セキュリティロール

推奨されるセキュリティロール設定：
- **閲覧者**: 読み取り権限のみ
- **編集者**: 読み取り・作成・更新権限
- **管理者**: すべての権限

## 備考
- テーブルは組織所有（Organization-owned）として作成することを推奨
- 監査ログを有効化して変更履歴を追跡可能にすることを推奨
- `cr_markdown`フィールドの最大長は100,000文字（大規模プロセスに対応）
- Markdownの整合性を保つため、エディターを通じた編集を推奨
